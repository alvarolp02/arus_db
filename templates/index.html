<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ARUS Database</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/2.1.3/css/dataTables.bootstrap5.css" rel="stylesheet">

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/2.1.3/js/jquery.dataTables.js"></script>
  <script src="https://cdn.datatables.net/2.1.3/js/dataTables.bootstrap5.js"></script>

  <style>
    body { padding: 20px; }
    .dataTables_filter input { width: 200px; }
  </style>
</head>
<body>

  <h1 class="mb-4">ðŸ“Š ARUS Data Management</h1>

  <!-- NAV TABS -->
  <ul class="nav nav-tabs" id="mainTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="tests-tab" data-bs-toggle="tab" data-bs-target="#tests" type="button" role="tab">ðŸ§ª Tests</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="logs-tab" data-bs-toggle="tab" data-bs-target="#logs" type="button" role="tab">ðŸ“„ Logs</button>
    </li>
  </ul>

  <!-- TAB CONTENT -->
  <div class="tab-content mt-4">

    <!-- TESTS TAB -->
    <div class="tab-pane fade show active" id="tests" role="tabpanel">
      <table id="testsTable" class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>ID</th>
            <th>DescripciÃ³n</th>
            <th>Piloto</th>
            <th>DuraciÃ³n</th>
            <th>Fecha</th>
            <th>NÂº Logs</th>
          </tr>
        </thead>
        <tbody>
          {% for test in tests %}
          <tr>
            <td>{{ test.id }}</td>
            <td>{{ test.description }}</td>
            <td>{{ test.pilot.value }}</td>
            <td>
              {% if test.duration_sec %}
                {{ test.duration_sec // 60 }}:{{ "%02d"|format(test.duration_sec % 60) }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>{{ test.date.strftime("%Y-%m-%d %H:%M") }}</td>
            <td>{{ test.logs | length }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- LOGS TAB -->
    <div class="tab-pane fade" id="logs" role="tabpanel">
      <table id="logsTable" class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>ID</th>
            <th>Archivo</th>
            <th>VehÃ­culo</th>
            <th>Promedio</th>
            <th>Test ID</th>
            <th>Subido</th>
            <th>Descargar</th>
          </tr>
        </thead>
        <tbody>
          {% for log in logs %}
          <tr>
            <td>{{ log.id }}</td>
            <td>{{ log.filename }}</td>
            <td>{{ log.vehicle_id }}</td>
            <td>{{ "%.2f"|format(log.avg_value or 0) }}</td>
            <td>{{ log.test_id or "-" }}</td>
            <td>{{ log.uploaded_at.strftime("%Y-%m-%d %H:%M") }}</td>
            <td>
              <a href="/download/{{ log.id }}" class="btn btn-sm btn-primary">â¬‡ Descargar</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    $(document).ready(function() {
      // Inicializar DataTables
      $('#testsTable').DataTable({
        language: { url: 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json' },
        pageLength: 10,
      });
      $('#logsTable').DataTable({
        language: { url: 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json' },
        pageLength: 10,
      });
    });
  </script>

</body>
</html>
